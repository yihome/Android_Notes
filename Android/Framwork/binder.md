## 简介

Binder结合了共享内存和普通IPC来实现了一种相对快速，并且可控的IPC机制

* 快速：在Binder Server端采用mmap将内核空间的虚拟内存和Server用户空间的虚拟内存映射到同样一块物理内存上，和传统非共享内存的方式，少了一次内存的复制过程
* 可控：还是采用了C/S，相比于共享内存，架构清晰，稳定性好，同时可以增加鉴权过程

## Binder

Binder下有几个重要的对象，在进程通信过程中发挥比较重要的作用

* `/dev/binder` 我们可以通过这个虚拟设备可以直达Binder驱动，主要支持open、mmap、iotcl等操作
* `ProcessState`
* `IPCThreadState`
* `BpBinder`
* `BBinder` 

## 内存共享

`Binder` 的内存共享部分是通过`binder ` 驱动来完成的，这个过程在驱动的 `binder_mmap` 方法中完成，即在对`/dev/binder` 调用 `mmap` 方法时驱动程序会分别在进程虚拟内存和内存虚拟内存空间上各自申请一块大小一样的虚拟内存，然后再申请一页的物理内存，将进程空间的虚拟内存和内存空间的虚拟内存映射到这同样一块物理内存上。

`Binder` 通过上面的方式共享内存可以减少一次从内核空间到用户空间的内存复制，这个过程仅限在数据接收端，对于数据发送端而言，数据默认还是保存在用于空间，需要在通讯过程中显示的 `copyFromUser` 才能到达内核空间

> Binder通讯过程中只有实际的数据会通过共享内存的方式传输，减少一次内存的复制，对于通讯过程中的命令数据还是会有两次复制的过程

